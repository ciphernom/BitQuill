(()=>{"use strict";var t={567:(t,e,n)=>{t.exports=n.p+"0fbe6e64cb78ca0ccf55.wasm"}},e={};function n(o){var r=e[o];if(void 0!==r)return r.exports;var i=e[o]={exports:{}};return t[o](i,i.exports,n),i.exports}let o;function r(t){const e=o.__externref_table_alloc();return o.__wbindgen_export_2.set(e,t),e}function i(t,e){try{return t.apply(this,e)}catch(t){const e=r(t);o.__wbindgen_exn_store(e)}}n.m=t,n.u=t=>t+".main.js",n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;n.g.importScripts&&(t=n.g.location+"");var e=n.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var o=e.getElementsByTagName("script");if(o.length)for(var r=o.length-1;r>-1&&(!t||!/^http(s?):/.test(t));)t=o[r--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=t})(),n.b=document.baseURI||self.location.href;const s="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&s.decode();let a=null;function c(){return null!==a&&0!==a.byteLength||(a=new Uint8Array(o.memory.buffer)),a}function l(t,e){return t>>>=0,s.decode(c().subarray(t,t+e))}function d(t){return null==t}function u(t){const e=typeof t;if("number"==e||"boolean"==e||null==t)return`${t}`;if("string"==e)return`"${t}"`;if("symbol"==e){const e=t.description;return null==e?"Symbol":`Symbol(${e})`}if("function"==e){const e=t.name;return"string"==typeof e&&e.length>0?`Function(${e})`:"Function"}if(Array.isArray(t)){const e=t.length;let n="[";e>0&&(n+=u(t[0]));for(let o=1;o<e;o++)n+=", "+u(t[o]);return n+="]",n}const n=/\[object ([^\]]+)\]/.exec(toString.call(t));let o;if(!(n&&n.length>1))return toString.call(t);if(o=n[1],"Object"==o)try{return"Object("+JSON.stringify(t)+")"}catch(t){return"Object"}return t instanceof Error?`${t.name}: ${t.message}\n${t.stack}`:o}let f=0;const _="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},g="function"==typeof _.encodeInto?function(t,e){return _.encodeInto(t,e)}:function(t,e){const n=_.encode(t);return e.set(n),{read:t.length,written:n.length}};function m(t,e,n){if(void 0===n){const n=_.encode(t),o=e(n.length,1)>>>0;return c().subarray(o,o+n.length).set(n),f=n.length,o}let o=t.length,r=e(o,1)>>>0;const i=c();let s=0;for(;s<o;s++){const e=t.charCodeAt(s);if(e>127)break;i[r+s]=e}if(s!==o){0!==s&&(t=t.slice(s)),r=n(r,o,o=s+3*t.length,1)>>>0;const e=c().subarray(r+s,r+o);s+=g(t,e).written,r=n(r,o,s,1)>>>0}return f=s,r}let p=null;function h(){return(null===p||!0===p.buffer.detached||void 0===p.buffer.detached&&p.buffer!==o.memory.buffer)&&(p=new DataView(o.memory.buffer)),p}function b(t){const e=o.__wbindgen_export_2.get(t);return o.__externref_table_dealloc(t),e}const w="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>o.__wbg_vdfcomputer_free(t>>>0,1));class y{static __wrap(t){t>>>=0;const e=Object.create(y.prototype);return e.__wbg_ptr=t,w.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,w.unregister(this),t}free(){const t=this.__destroy_into_raw();o.__wbg_vdfcomputer_free(t,0)}constructor(){const t=o.vdfcomputer_new();return this.__wbg_ptr=t>>>0,w.register(this,this.__wbg_ptr,this),this}static with_modulus(t){const e=m(t,o.__wbindgen_malloc,o.__wbindgen_realloc),n=f,r=o.vdfcomputer_with_modulus(e,n);if(r[2])throw b(r[1]);return y.__wrap(r[0])}compute_proof(t,e,n){const i=m(t,o.__wbindgen_malloc,o.__wbindgen_realloc),s=f,a=o.vdfcomputer_compute_proof(this.__wbg_ptr,i,s,e,d(n)?0:r(n));if(a[2])throw b(a[1]);return E.__wrap(a[0])}verify_proof(t,e){const n=m(t,o.__wbindgen_malloc,o.__wbindgen_realloc),r=f;!function(t,e){if(!(t instanceof e))throw new Error(`expected instance of ${e.name}`)}(e,E);const i=o.vdfcomputer_verify_proof(this.__wbg_ptr,n,r,e.__wbg_ptr);if(i[2])throw b(i[1]);return 0!==i[0]}estimate_iterations_for_seconds(t){const e=o.vdfcomputer_estimate_iterations_for_seconds(this.__wbg_ptr,t);return BigInt.asUintN(64,e)}}const v="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>o.__wbg_vdfproof_free(t>>>0,1));class E{static __wrap(t){t>>>=0;const e=Object.create(E.prototype);return e.__wbg_ptr=t,v.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,v.unregister(this),t}free(){const t=this.__destroy_into_raw();o.__wbg_vdfproof_free(t,0)}constructor(t,e,n,r,i){const s=m(t,o.__wbindgen_malloc,o.__wbindgen_realloc),a=f,c=m(e,o.__wbindgen_malloc,o.__wbindgen_realloc),l=f,d=m(n,o.__wbindgen_malloc,o.__wbindgen_realloc),u=f,_=m(r,o.__wbindgen_malloc,o.__wbindgen_realloc),g=f,p=o.vdfproof_new(s,a,c,l,d,u,_,g,i);return this.__wbg_ptr=p>>>0,v.register(this,this.__wbg_ptr,this),this}get y(){let t,e;try{const n=o.vdfproof_y(this.__wbg_ptr);return t=n[0],e=n[1],l(n[0],n[1])}finally{o.__wbindgen_free(t,e,1)}}get pi(){let t,e;try{const n=o.vdfproof_pi(this.__wbg_ptr);return t=n[0],e=n[1],l(n[0],n[1])}finally{o.__wbindgen_free(t,e,1)}}get l(){let t,e;try{const n=o.vdfproof_l(this.__wbg_ptr);return t=n[0],e=n[1],l(n[0],n[1])}finally{o.__wbindgen_free(t,e,1)}}get r(){let t,e;try{const n=o.vdfproof_r(this.__wbg_ptr);return t=n[0],e=n[1],l(n[0],n[1])}finally{o.__wbindgen_free(t,e,1)}}get iterations(){const t=o.vdfproof_iterations(this.__wbg_ptr);return BigInt.asUintN(64,t)}to_json(){let t,e;try{const i=o.vdfproof_to_json(this.__wbg_ptr);var n=i[0],r=i[1];if(i[3])throw n=0,r=0,b(i[2]);return t=n,e=r,l(n,r)}finally{o.__wbindgen_free(t,e,1)}}static from_json(t){const e=m(t,o.__wbindgen_malloc,o.__wbindgen_realloc),n=f,r=o.vdfproof_from_json(e,n);if(r[2])throw b(r[1]);return E.__wrap(r[0])}}function S(){const t={wbg:{}};return t.wbg.__wbg_buffer_609cc3eee51ed158=function(t){return t.buffer},t.wbg.__wbg_call_672a4d21634d4a24=function(){return i(function(t,e){return t.call(e)},arguments)},t.wbg.__wbg_call_7cccdd69e0791ae2=function(){return i(function(t,e,n){return t.call(e,n)},arguments)},t.wbg.__wbg_crypto_574e78ad8b13b65f=function(t){return t.crypto},t.wbg.__wbg_getRandomValues_b8f5dbd5f3995a9e=function(){return i(function(t,e){t.getRandomValues(e)},arguments)},t.wbg.__wbg_log_5b9c4377e97c70b5=function(t,e){console.log(l(t,e))},t.wbg.__wbg_msCrypto_a61aeb35a24c1329=function(t){return t.msCrypto},t.wbg.__wbg_new_a12002a7f91c75be=function(t){return new Uint8Array(t)},t.wbg.__wbg_newnoargs_105ed471475aaf50=function(t,e){return new Function(l(t,e))},t.wbg.__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a=function(t,e,n){return new Uint8Array(t,e>>>0,n>>>0)},t.wbg.__wbg_newwithlength_a381634e90c276d4=function(t){return new Uint8Array(t>>>0)},t.wbg.__wbg_node_905d3e251edff8a2=function(t){return t.node},t.wbg.__wbg_now_807e54c39636c349=function(){return Date.now()},t.wbg.__wbg_process_dc0fbacc7c1c06f7=function(t){return t.process},t.wbg.__wbg_randomFillSync_ac0988aba3254290=function(){return i(function(t,e){t.randomFillSync(e)},arguments)},t.wbg.__wbg_require_60cc747a6bc5215a=function(){return i(function(){return module.require},arguments)},t.wbg.__wbg_set_65595bdd868b3009=function(t,e,n){t.set(e,n>>>0)},t.wbg.__wbg_static_accessor_GLOBAL_88a902d13a557d07=function(){const t="undefined"==typeof global?null:global;return d(t)?0:r(t)},t.wbg.__wbg_static_accessor_GLOBAL_THIS_56578be7e9f832b0=function(){const t="undefined"==typeof globalThis?null:globalThis;return d(t)?0:r(t)},t.wbg.__wbg_static_accessor_SELF_37c5d418e4bf5819=function(){const t="undefined"==typeof self?null:self;return d(t)?0:r(t)},t.wbg.__wbg_static_accessor_WINDOW_5de37043a91a9c40=function(){const t="undefined"==typeof window?null:window;return d(t)?0:r(t)},t.wbg.__wbg_subarray_aa9065fa9dc5df96=function(t,e,n){return t.subarray(e>>>0,n>>>0)},t.wbg.__wbg_versions_c01dfd4722a88165=function(t){return t.versions},t.wbg.__wbg_warn_1e5be50445417c8a=function(t,e){console.warn(l(t,e))},t.wbg.__wbindgen_debug_string=function(t,e){const n=m(u(e),o.__wbindgen_malloc,o.__wbindgen_realloc),r=f;h().setInt32(t+4,r,!0),h().setInt32(t+0,n,!0)},t.wbg.__wbindgen_init_externref_table=function(){const t=o.__wbindgen_export_2,e=t.grow(4);t.set(0,void 0),t.set(e+0,void 0),t.set(e+1,null),t.set(e+2,!0),t.set(e+3,!1)},t.wbg.__wbindgen_is_function=function(t){return"function"==typeof t},t.wbg.__wbindgen_is_object=function(t){return"object"==typeof t&&null!==t},t.wbg.__wbindgen_is_string=function(t){return"string"==typeof t},t.wbg.__wbindgen_is_undefined=function(t){return void 0===t},t.wbg.__wbindgen_memory=function(){return o.memory},t.wbg.__wbindgen_number_new=function(t){return t},t.wbg.__wbindgen_string_new=function(t,e){return l(t,e)},t.wbg.__wbindgen_throw=function(t,e){throw new Error(l(t,e))},t}async function x(t){if(void 0!==o)return o;void 0!==t&&(Object.getPrototypeOf(t)===Object.prototype?({module_or_path:t}=t):console.warn("using deprecated parameters for the initialization function; pass a single object instead")),void 0===t&&(t=new URL(n(567),n.b));const e=S();("string"==typeof t||"function"==typeof Request&&t instanceof Request||"function"==typeof URL&&t instanceof URL)&&(t=fetch(t));const{instance:r,module:i}=await async function(t,e){if("function"==typeof Response&&t instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(t,e)}catch(e){if("application/wasm"==t.headers.get("Content-Type"))throw e;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",e)}const n=await t.arrayBuffer();return await WebAssembly.instantiate(n,e)}{const n=await WebAssembly.instantiate(t,e);return n instanceof WebAssembly.Instance?{instance:n,module:t}:n}}(await t,e);return function(t,e){return o=t.exports,x.__wbindgen_wasm_module=e,p=null,a=null,o.__wbindgen_start(),o}(r,i)}const I=x;async function $(t){const e=(new TextEncoder).encode(t),n=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(n)).map(t=>t.toString(16).padStart(2,"0")).join("")}class D{constructor(t,e,n,o,r,i){this.epochNumber=t,this.previousHash=e,this.deltas=n,this.vdfProof={y:"function"==typeof o.y?o.y():o.y,pi:"function"==typeof o.pi?o.pi():o.pi,l:"function"==typeof o.l?o.l():o.l,r:"function"==typeof o.r?o.r():o.r},this.iterations=r,this.epochDuration=i,this.timestamp=(new Date).toISOString(),this.hash=null}async computeHash(){const t={epochNumber:this.epochNumber,previousHash:this.previousHash,deltas:this.deltas,vdfY:this.vdfProof.y,iterations:this.iterations};return this.hash=await $(JSON.stringify(t)),this.hash}}const B="bitquill-doc-";function k(t){const e=localStorage.getItem(t);return e?JSON.parse(e):null}function C(t,e="info"){const n=document.getElementById("toast-container"),o=document.createElement("div");o.className=`toast ${e}`,o.textContent=t,n.appendChild(o),setTimeout(()=>o.classList.add("show"),10),setTimeout(()=>{o.classList.remove("show"),setTimeout(()=>n.removeChild(o),300)},5e3)}function L(t){const e=t.getText(),n=e.trim().split(/\s+/).filter(t=>t.length>0).length,o=e.length-1;document.getElementById("word-count").textContent=`${n} words`,document.getElementById("char-count").textContent=`${o} characters`}function T(){document.getElementById("modal-backdrop").classList.remove("show"),document.getElementById("verification-modal").classList.remove("show")}function H(t,e){const n=document.getElementById("progress-circle"),o=document.getElementById("progress-text"),r=document.getElementById("verification-status"),i=2*Math.PI*54,s=i-t/100*i;n.style.strokeDashoffset=s,o.textContent=`${Math.round(t)}%`,r.textContent=e}function O(t,e="live",n=[]){const o=document.getElementById("proof-display");o.innerHTML="",t.forEach((t,r)=>{let i,s,a;if("verified"===e){const t=(t=>n.find(e=>e.includes(`at epoch ${t}`)||e.includes(`Epoch ${t}:`))||null)(r),e=!t;i=e?"✓":"✗",s=e?"var(--primary-color)":"#ff4444",a=e?"Verified":`Error: ${t}`}else i="●",s="var(--text-secondary)",a="Epoch created";const c=0===t.epochNumber?"GENESIS":`EPOCH #${t.epochNumber}`,l=(t.hash||"").substring(0,16)+"...",d=(t.epochDuration||0).toFixed(1)+"s",u=`<div title="${a}" style="padding: 4px 2px; border-bottom: 1px solid var(--bg-tertiary);"><span style="color: ${s}; font-weight: bold; margin-right: 8px;">${i}</span><span>${c}: ${l}</span>${t.epochNumber>0?`<span style="color: var(--text-secondary); font-size: 11px; margin-left: 1em;">(${d})</span>`:""}</div>`;o.innerHTML+=u}),"live"===e&&o.lastElementChild&&(o.lastElementChild.title="Current epoch"),o.scrollTop=o.scrollHeight}!async function(){await I();let t={currentDocumentKey:null,isDirty:!1};const e=new y;let o=1e5;try{console.log("Starting VDF calibration...");const t=1e4,n=performance.now();await e.compute_proof("calibration",BigInt(t),null);const r=t/((performance.now()-n)/1e3);o=Math.floor(10*r),console.log(`Calibrated to ${o} iterations for 10s`)}catch(t){console.error("VDF calibration failed, using fallback.",t),C("VDF calibration failed, using default timing.","error")}let r,i=[],s=[],a=!1,c=Date.now(),l=0;const d=new Quill("#editor",{theme:"snow",placeholder:"Start writing..."}),u=t=>{s=t},f=()=>s;async function _(){const t={title:document.getElementById("document-title").value||"Untitled Document",version:"2.0",timestamp:(new Date).toISOString(),content:{html:d.root.innerHTML,delta:d.getContents()},proofChain:s,metadata:{epochCount:s.length,genesisHash:s[0]?.hash,latestHash:s[s.length-1]?.hash,totalDuration:s.reduce((t,e)=>t+(e.epochDuration||0),0),documentHash:null}},e={...t,metadata:{...t.metadata,documentHash:null}};return t.metadata.documentHash=await $(JSON.stringify(e)),t}function g(){if(!s||0===s.length)return;a=!0,c=Date.now(),l=0;const t=s[s.length-1];r.postMessage({command:"start",input:t.hash,iterations:o})}function m(){r&&r.terminate(),i=[],r=new Worker(new URL("/"+n.u(96),n.b)),r.onmessage=async e=>{const{status:n,proof:r,progress:d,error:u}=e.data;if("progress"!==n){if("error"===n)return console.error("VDF Worker Error:",u),void(a=!1);if("complete"===n){const e=(Date.now()-c)/1e3;if(i.length>0){const n=s[s.length-1],a=new D(s.length,n.hash,i,r,o,e);await a.computeHash(),s.push(a),document.getElementById("epoch-number").textContent=a.epochNumber,O(s),i=[],t.isDirty=!0}g()}}else l=d},g()}function p(e,n){d.setContents(e.content.delta),u(e.proofChain),document.getElementById("document-title").value=e.title||"Untitled Document",t.currentDocumentKey=n,t.isDirty=!1;const o=e.proofChain[e.proofChain.length-1];document.getElementById("epoch-number").textContent=o.epochNumber,document.getElementById("last-saved").textContent=`Saved ${new Date(e.timestamp).toLocaleTimeString()}`,O(f()),L(d),m()}function h(){t.isDirty&&!confirm("You have unsaved changes. Are you sure you want to create a new document?")||(d.setContents([{insert:"\n"}]),t.currentDocumentKey=null,t.isDirty=!1,document.getElementById("document-title").value="Untitled Document",document.getElementById("last-saved").textContent="Not saved",u([{epochNumber:0,hash:"0000000000000000000000000000000000000000000000000000000000000000",timestamp:(new Date).toISOString()}]),O(f()),m(),C("New document created.","info"))}d.on("text-change",(e,n,o)=>{"user"===o&&(i.push(e),t.isDirty=!0),L(d)}),document.getElementById("new-doc-btn").onclick=h,document.getElementById("save-btn").onclick=async()=>{let e=t.currentDocumentKey||B+Date.now();t.currentDocumentKey=e,function(t,e){try{localStorage.setItem(t,JSON.stringify(e))}catch(t){console.error("Error saving to local storage:",t),C("Could not save document. Storage may be full.","error")}}(e,await _()),t.isDirty=!1,document.getElementById("last-saved").textContent=`Saved ${(new Date).toLocaleTimeString()}`,C("Document saved to browser","success")},document.getElementById("import-btn").onclick=()=>document.getElementById("file-input").click(),document.getElementById("verify-live-btn").onclick=async()=>{C("Verifying current document...","info");const t=await _();document.getElementById("modal-backdrop").classList.add("show"),document.getElementById("verification-modal").classList.add("show"),document.querySelector(".verification-progress").style.display="block",document.getElementById("verification-results").style.display="none",H(0,"Starting verification...");const e=await async function(t,e){const n={valid:!0,errors:[],verifiedEpochs:0,totalEpochs:0};try{await I();const o=new y,r=t.proofChain;n.totalEpochs=r.length-1;for(let t=1;t<r.length;t++){const i=r[t];if(e&&e(t/(r.length-1)*100,`Verifying epoch ${t}/${r.length-1}...`),i.previousHash!==r[t-1].hash){n.errors.push(`Epoch ${t}: Broken chain.`),n.valid=!1;continue}try{if(!i.vdfProof||!i.vdfProof.y)throw new Error("Missing VDF proof data.");const t=new E(i.vdfProof.y,i.vdfProof.pi,i.vdfProof.l,i.vdfProof.r,BigInt(i.iterations));if(!await o.verify_proof(i.previousHash,t))throw new Error("Invalid VDF proof.");n.verifiedEpochs++}catch(e){n.errors.push(`Epoch ${t}: VDF verification error: ${e.message}`),n.valid=!1}const s={epochNumber:i.epochNumber,previousHash:i.previousHash,deltas:i.deltas,vdfY:i.vdfProof.y,iterations:i.iterations},a=await $(JSON.stringify(s));i.hash!==a&&(n.errors.push(`Epoch ${t}: Hash mismatch.`),n.valid=!1)}n.valid=0===n.errors.length}catch(t){n.valid=!1,n.errors.push(t.message)}return n}(t,H);(function(t,e){document.querySelector(".verification-progress").style.display="none";const n=document.getElementById("verification-results");n.style.display="block";const o=function(t){const e=function(t){const e=t.slice(1).map(t=>{let e=[];return t.deltas&&t.deltas.forEach(t=>{t&&t.ops&&(e=e.concat(t.ops))}),{deltas:e,duration:t.epochDuration}});if(0===e.length)return{humanScore:0,details:{},metrics:{}};for(const t of e)if(t.deltas){if(t.deltas.length>200)return{humanScore:.05,details:{anomalyReason:"Edit storm detected."},metrics:{}};for(const e of t.deltas)if(e.insert&&e.insert.length>100)return{humanScore:.1,details:{anomalyReason:"Large paste detected."},metrics:{}}}const n=e.map(t=>t.deltas.reduce((t,e)=>t+(e.insert?.length||0),0)),o=n.reduce((t,e)=>t+e,0)/n.length||0,r=n.reduce((t,e)=>t+Math.pow(e-o,2),0)/n.length/(o+1),i=e.filter(t=>0===t.deltas.length).length/e.length,s=e.map(t=>t.deltas.filter(t=>t.insert).length>10?"burst":t.deltas.filter(t=>t.delete).length>t.deltas.filter(t=>t.insert).length?"revision":0===t.deltas.length?"pause":"steady"),a=s.reduce((t,e)=>(t[e]=(t[e]||0)+1,t),{}),c=-Object.values(a).reduce((t,e)=>t-e/s.length*Math.log2(e/s.length),0),l=e.filter(t=>t.deltas.length>0).map(t=>t.deltas.reduce((t,e)=>t+(e.insert?.length||0),0)/10),d=l.reduce((t,e)=>t+e,0)/l.length||0,u=t=>1/(1+Math.exp(-t)),f=(t,e,n)=>Math.exp(-.5*Math.pow((t-e)/n,2)),_={burstScore:u(2*(r-.5)),pauseScore:u(15*(i-.05)),entropyScore:f(c,1,.7),speedScore:f(d,5,3)},g={burstScore:.4,pauseScore:.2,entropyScore:.2,speedScore:.2};return{humanScore:Object.entries(_).reduce((t,[e,n])=>t+n*g[e],0),details:_}}(t);return`\n    <div class="authorship-analysis">\n      <h3>Authorship Analysis</h3>\n      <div class="human-score">${Math.round(100*e.humanScore)}% Human Characteristics</div>\n      <div class="details">\n        <div>Typing Rhythm: ${Math.round(100*(e.details.burstScore||0))}%</div>\n        <div>Pause Patterns: ${Math.round(100*(e.details.pauseScore||0))}%</div>\n        <div>Edit Complexity: ${Math.round(100*(e.details.entropyScore||0))}%</div>\n        <div>Speed Profile: ${Math.round(100*(e.details.speedScore||0))}%</div>\n      </div>\n    </div>\n  `}(e.proofChain);t.valid?n.innerHTML=`\n      <div style="color: var(--primary-color); margin-bottom: 16px; font-size: 18px;">✓ Document verified successfully</div>\n      <div style="margin-bottom: 8px;">Verified Epochs: ${t.verifiedEpochs}/${t.totalEpochs}</div>\n      <div style="margin-bottom: 8px;">Total Duration: ${(e.metadata.totalDuration/60).toFixed(1)} minutes</div>\n      <div style="margin-bottom: 16px;">Final Hash: ${e.metadata.latestHash.substring(0,16)}...</div>\n      ${o}`:n.innerHTML=`\n      <div style="color: #ff4444; margin-bottom: 16px; font-size: 18px;">✗ Verification failed</div>\n      <div style="color: #ff4444; margin-bottom: 16px;">${t.errors.join("<br>")}</div>\n      ${o}`})(e,t),O(f(),"verified",e.errors)};const b=document.getElementById("file-browser-modal"),w=document.getElementById("modal-backdrop"),v=()=>{const t=document.getElementById("file-browser-list");t.innerHTML="";const e=function(){const t=[];for(let e=0;e<localStorage.length;e++){const n=localStorage.key(e);if(n.startsWith(B))try{const e=k(n);e&&e.title&&e.timestamp&&t.push({key:n,title:e.title,timestamp:e.timestamp})}catch(t){console.error(`Could not parse document with key ${n}:`,t)}}return t.sort((t,e)=>new Date(e.timestamp)-new Date(t.timestamp))}();0===e.length?t.innerHTML='<p style="color: var(--text-secondary);">No documents saved in this browser.</p>':e.forEach(e=>{const n=document.createElement("div");n.className="file-browser-item",n.innerHTML=`\n          <div class="file-item-info" data-key="${e.key}">\n            <div class="file-browser-title">${e.title}</div>\n            <div class="file-browser-timestamp">Saved: ${new Date(e.timestamp).toLocaleString()}</div>\n          </div>\n          <div class="file-browser-actions">\n            <button class="btn-icon export-btn" title="Export to File" data-key="${e.key}"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg></button>\n            <button class="btn-icon delete-btn" title="Delete" data-key="${e.key}"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg></button>\n          </div>`,t.appendChild(n)}),w.classList.add("show"),b.classList.add("show")},S=()=>{w.classList.remove("show"),b.classList.remove("show")};document.getElementById("browse-local-btn").onclick=v,document.getElementById("file-browser-close").onclick=S,document.getElementById("file-browser-list").addEventListener("click",e=>{const n=e.target.closest("[data-key]");if(!n)return;const o=n.getAttribute("data-key");if(e.target.closest(".delete-btn"))confirm(`Are you sure you want to delete "${k(o).title}"? This cannot be undone.`)&&(function(t){localStorage.removeItem(t)}(o),C("Document deleted","info"),v());else if(e.target.closest(".export-btn")){const t=k(o),e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download=`${t.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.json`,r.click(),URL.revokeObjectURL(n),C("Exporting document...","info")}else if(e.target.closest(".file-item-info")){if(t.isDirty&&!confirm("You have unsaved changes that will be lost. Load document anyway?"))return;const e=k(o);p(e,o),S(),C(`Loaded "${e.title}"`,"success")}}),document.getElementById("file-input").onchange=async e=>{if(e.target.files[0]){C("Importing and verifying...","info");try{const n=await e.target.files[0].text(),o=JSON.parse(n);if(t.isDirty&&!confirm("You have unsaved changes that will be lost. Import anyway?"))return;p(o,null),C("Document imported successfully","success")}catch(t){C(`Error importing file: ${t.message}`,"error")}finally{e.target.value=""}}},document.getElementById("epoch-indicator").onclick=()=>document.getElementById("proof-panel").classList.toggle("show"),document.getElementById("proof-panel-close").onclick=()=>document.getElementById("proof-panel").classList.remove("show"),w.onclick=()=>{T(),S()},document.getElementById("modal-close").onclick=T,h(),C("VDF calibration complete","success"),setInterval(()=>{if(a){const t=(Date.now()-c)/1e3;!function(t,e,n){const o=document.getElementById("timer-countdown");if(o){const e=Math.max(0,10-t);o.textContent=`${e.toFixed(1)}s`}const r=document.getElementById("vdf-progress-bar");r&&(r.style.transform=`scaleX(${n/100})`)}(t,0,l>0?l:Math.min(100,t/10*100))}},50)}()})();