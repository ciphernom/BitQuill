(()=>{"use strict";var e={567:(e,t,n)=>{e.exports=n.p+"0fbe6e64cb78ca0ccf55.wasm"}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,n),i.exports}let o;function r(e){const t=o.__externref_table_alloc();return o.__wbindgen_export_2.set(t,e),t}function i(e,t){try{return e.apply(this,t)}catch(e){const t=r(e);o.__wbindgen_exn_store(t)}}n.m=e,n.u=e=>e+".main.js",n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.p="/BitQuill/",n.b=document.baseURI||self.location.href;const s="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&s.decode();let a=null;function c(){return null!==a&&0!==a.byteLength||(a=new Uint8Array(o.memory.buffer)),a}function l(e,t){return e>>>=0,s.decode(c().subarray(e,e+t))}function d(e){return null==e}function u(e){const t=typeof e;if("number"==t||"boolean"==t||null==e)return`${e}`;if("string"==t)return`"${e}"`;if("symbol"==t){const t=e.description;return null==t?"Symbol":`Symbol(${t})`}if("function"==t){const t=e.name;return"string"==typeof t&&t.length>0?`Function(${t})`:"Function"}if(Array.isArray(e)){const t=e.length;let n="[";t>0&&(n+=u(e[0]));for(let o=1;o<t;o++)n+=", "+u(e[o]);return n+="]",n}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let o;if(!(n&&n.length>1))return toString.call(e);if(o=n[1],"Object"==o)try{return"Object("+JSON.stringify(e)+")"}catch(e){return"Object"}return e instanceof Error?`${e.name}: ${e.message}\n${e.stack}`:o}let f=0;const _="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},g="function"==typeof _.encodeInto?function(e,t){return _.encodeInto(e,t)}:function(e,t){const n=_.encode(e);return t.set(n),{read:e.length,written:n.length}};function m(e,t,n){if(void 0===n){const n=_.encode(e),o=t(n.length,1)>>>0;return c().subarray(o,o+n.length).set(n),f=n.length,o}let o=e.length,r=t(o,1)>>>0;const i=c();let s=0;for(;s<o;s++){const t=e.charCodeAt(s);if(t>127)break;i[r+s]=t}if(s!==o){0!==s&&(e=e.slice(s)),r=n(r,o,o=s+3*e.length,1)>>>0;const t=c().subarray(r+s,r+o);s+=g(e,t).written,r=n(r,o,s,1)>>>0}return f=s,r}let p=null;function h(){return(null===p||!0===p.buffer.detached||void 0===p.buffer.detached&&p.buffer!==o.memory.buffer)&&(p=new DataView(o.memory.buffer)),p}function b(e){const t=o.__wbindgen_export_2.get(e);return o.__externref_table_dealloc(e),t}const w="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>o.__wbg_vdfcomputer_free(e>>>0,1));class y{static __wrap(e){e>>>=0;const t=Object.create(y.prototype);return t.__wbg_ptr=e,w.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,w.unregister(this),e}free(){const e=this.__destroy_into_raw();o.__wbg_vdfcomputer_free(e,0)}constructor(){const e=o.vdfcomputer_new();return this.__wbg_ptr=e>>>0,w.register(this,this.__wbg_ptr,this),this}static with_modulus(e){const t=m(e,o.__wbindgen_malloc,o.__wbindgen_realloc),n=f,r=o.vdfcomputer_with_modulus(t,n);if(r[2])throw b(r[1]);return y.__wrap(r[0])}compute_proof(e,t,n){const i=m(e,o.__wbindgen_malloc,o.__wbindgen_realloc),s=f,a=o.vdfcomputer_compute_proof(this.__wbg_ptr,i,s,t,d(n)?0:r(n));if(a[2])throw b(a[1]);return E.__wrap(a[0])}verify_proof(e,t){const n=m(e,o.__wbindgen_malloc,o.__wbindgen_realloc),r=f;!function(e,t){if(!(e instanceof t))throw new Error(`expected instance of ${t.name}`)}(t,E);const i=o.vdfcomputer_verify_proof(this.__wbg_ptr,n,r,t.__wbg_ptr);if(i[2])throw b(i[1]);return 0!==i[0]}estimate_iterations_for_seconds(e){const t=o.vdfcomputer_estimate_iterations_for_seconds(this.__wbg_ptr,e);return BigInt.asUintN(64,t)}}const v="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>o.__wbg_vdfproof_free(e>>>0,1));class E{static __wrap(e){e>>>=0;const t=Object.create(E.prototype);return t.__wbg_ptr=e,v.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,v.unregister(this),e}free(){const e=this.__destroy_into_raw();o.__wbg_vdfproof_free(e,0)}constructor(e,t,n,r,i){const s=m(e,o.__wbindgen_malloc,o.__wbindgen_realloc),a=f,c=m(t,o.__wbindgen_malloc,o.__wbindgen_realloc),l=f,d=m(n,o.__wbindgen_malloc,o.__wbindgen_realloc),u=f,_=m(r,o.__wbindgen_malloc,o.__wbindgen_realloc),g=f,p=o.vdfproof_new(s,a,c,l,d,u,_,g,i);return this.__wbg_ptr=p>>>0,v.register(this,this.__wbg_ptr,this),this}get y(){let e,t;try{const n=o.vdfproof_y(this.__wbg_ptr);return e=n[0],t=n[1],l(n[0],n[1])}finally{o.__wbindgen_free(e,t,1)}}get pi(){let e,t;try{const n=o.vdfproof_pi(this.__wbg_ptr);return e=n[0],t=n[1],l(n[0],n[1])}finally{o.__wbindgen_free(e,t,1)}}get l(){let e,t;try{const n=o.vdfproof_l(this.__wbg_ptr);return e=n[0],t=n[1],l(n[0],n[1])}finally{o.__wbindgen_free(e,t,1)}}get r(){let e,t;try{const n=o.vdfproof_r(this.__wbg_ptr);return e=n[0],t=n[1],l(n[0],n[1])}finally{o.__wbindgen_free(e,t,1)}}get iterations(){const e=o.vdfproof_iterations(this.__wbg_ptr);return BigInt.asUintN(64,e)}to_json(){let e,t;try{const i=o.vdfproof_to_json(this.__wbg_ptr);var n=i[0],r=i[1];if(i[3])throw n=0,r=0,b(i[2]);return e=n,t=r,l(n,r)}finally{o.__wbindgen_free(e,t,1)}}static from_json(e){const t=m(e,o.__wbindgen_malloc,o.__wbindgen_realloc),n=f,r=o.vdfproof_from_json(t,n);if(r[2])throw b(r[1]);return E.__wrap(r[0])}}function x(){const e={wbg:{}};return e.wbg.__wbg_buffer_609cc3eee51ed158=function(e){return e.buffer},e.wbg.__wbg_call_672a4d21634d4a24=function(){return i(function(e,t){return e.call(t)},arguments)},e.wbg.__wbg_call_7cccdd69e0791ae2=function(){return i(function(e,t,n){return e.call(t,n)},arguments)},e.wbg.__wbg_crypto_574e78ad8b13b65f=function(e){return e.crypto},e.wbg.__wbg_getRandomValues_b8f5dbd5f3995a9e=function(){return i(function(e,t){e.getRandomValues(t)},arguments)},e.wbg.__wbg_log_5b9c4377e97c70b5=function(e,t){console.log(l(e,t))},e.wbg.__wbg_msCrypto_a61aeb35a24c1329=function(e){return e.msCrypto},e.wbg.__wbg_new_a12002a7f91c75be=function(e){return new Uint8Array(e)},e.wbg.__wbg_newnoargs_105ed471475aaf50=function(e,t){return new Function(l(e,t))},e.wbg.__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a=function(e,t,n){return new Uint8Array(e,t>>>0,n>>>0)},e.wbg.__wbg_newwithlength_a381634e90c276d4=function(e){return new Uint8Array(e>>>0)},e.wbg.__wbg_node_905d3e251edff8a2=function(e){return e.node},e.wbg.__wbg_now_807e54c39636c349=function(){return Date.now()},e.wbg.__wbg_process_dc0fbacc7c1c06f7=function(e){return e.process},e.wbg.__wbg_randomFillSync_ac0988aba3254290=function(){return i(function(e,t){e.randomFillSync(t)},arguments)},e.wbg.__wbg_require_60cc747a6bc5215a=function(){return i(function(){return module.require},arguments)},e.wbg.__wbg_set_65595bdd868b3009=function(e,t,n){e.set(t,n>>>0)},e.wbg.__wbg_static_accessor_GLOBAL_88a902d13a557d07=function(){const e="undefined"==typeof global?null:global;return d(e)?0:r(e)},e.wbg.__wbg_static_accessor_GLOBAL_THIS_56578be7e9f832b0=function(){const e="undefined"==typeof globalThis?null:globalThis;return d(e)?0:r(e)},e.wbg.__wbg_static_accessor_SELF_37c5d418e4bf5819=function(){const e="undefined"==typeof self?null:self;return d(e)?0:r(e)},e.wbg.__wbg_static_accessor_WINDOW_5de37043a91a9c40=function(){const e="undefined"==typeof window?null:window;return d(e)?0:r(e)},e.wbg.__wbg_subarray_aa9065fa9dc5df96=function(e,t,n){return e.subarray(t>>>0,n>>>0)},e.wbg.__wbg_versions_c01dfd4722a88165=function(e){return e.versions},e.wbg.__wbg_warn_1e5be50445417c8a=function(e,t){console.warn(l(e,t))},e.wbg.__wbindgen_debug_string=function(e,t){const n=m(u(t),o.__wbindgen_malloc,o.__wbindgen_realloc),r=f;h().setInt32(e+4,r,!0),h().setInt32(e+0,n,!0)},e.wbg.__wbindgen_init_externref_table=function(){const e=o.__wbindgen_export_2,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)},e.wbg.__wbindgen_is_function=function(e){return"function"==typeof e},e.wbg.__wbindgen_is_object=function(e){return"object"==typeof e&&null!==e},e.wbg.__wbindgen_is_string=function(e){return"string"==typeof e},e.wbg.__wbindgen_is_undefined=function(e){return void 0===e},e.wbg.__wbindgen_memory=function(){return o.memory},e.wbg.__wbindgen_number_new=function(e){return e},e.wbg.__wbindgen_string_new=function(e,t){return l(e,t)},e.wbg.__wbindgen_throw=function(e,t){throw new Error(l(e,t))},e}async function I(e){if(void 0!==o)return o;void 0!==e&&(Object.getPrototypeOf(e)===Object.prototype?({module_or_path:e}=e):console.warn("using deprecated parameters for the initialization function; pass a single object instead")),void 0===e&&(e=new URL(n(567),n.b));const t=x();("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e));const{instance:r,module:i}=await async function(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if("application/wasm"==e.headers.get("Content-Type"))throw t;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t)}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}(await e,t);return function(e,t){return o=e.exports,I.__wbindgen_wasm_module=t,p=null,a=null,o.__wbindgen_start(),o}(r,i)}const S=I;async function D(e){const t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,"0")).join("")}class ${constructor(e,t,n,o,r,i){this.epochNumber=e,this.previousHash=t,this.deltas=n,this.vdfProof={y:"function"==typeof o.y?o.y():o.y,pi:"function"==typeof o.pi?o.pi():o.pi,l:"function"==typeof o.l?o.l():o.l,r:"function"==typeof o.r?o.r():o.r},this.iterations=r,this.epochDuration=i,this.timestamp=(new Date).toISOString(),this.hash=null}async computeHash(){const e={epochNumber:this.epochNumber,previousHash:this.previousHash,deltas:this.deltas,vdfY:this.vdfProof.y,iterations:this.iterations};return this.hash=await D(JSON.stringify(e)),this.hash}}const B="bitquill-doc-";function k(e){const t=localStorage.getItem(e);return t?JSON.parse(t):null}function L(e,t="info"){const n=document.getElementById("toast-container"),o=document.createElement("div");o.className=`toast ${t}`,o.textContent=e,n.appendChild(o),setTimeout(()=>o.classList.add("show"),10),setTimeout(()=>{o.classList.remove("show"),setTimeout(()=>n.removeChild(o),300)},5e3)}function C(e){const t=e.getText(),n=t.trim().split(/\s+/).filter(e=>e.length>0).length,o=t.length-1;document.getElementById("word-count").textContent=`${n} words`,document.getElementById("char-count").textContent=`${o} characters`}function H(){document.getElementById("modal-backdrop").classList.remove("show"),document.getElementById("verification-modal").classList.remove("show")}function O(e,t){const n=document.getElementById("progress-circle"),o=document.getElementById("progress-text"),r=document.getElementById("verification-status"),i=2*Math.PI*54,s=i-e/100*i;n.style.strokeDashoffset=s,o.textContent=`${Math.round(e)}%`,r.textContent=t}function M(e,t="live",n=[]){const o=document.getElementById("proof-display");o.innerHTML="",e.forEach((e,r)=>{let i,s,a;if("verified"===t){const e=(e=>n.find(t=>t.includes(`at epoch ${e}`)||t.includes(`Epoch ${e}:`))||null)(r),t=!e;i=t?"✓":"✗",s=t?"var(--primary-color)":"#ff4444",a=t?"Verified":`Error: ${e}`}else i="●",s="var(--text-secondary)",a="Epoch created";const c=0===e.epochNumber?"GENESIS":`EPOCH #${e.epochNumber}`,l=(e.hash||"").substring(0,16)+"...",d=(e.epochDuration||0).toFixed(1)+"s",u=`<div title="${a}" style="padding: 4px 2px; border-bottom: 1px solid var(--bg-tertiary);"><span style="color: ${s}; font-weight: bold; margin-right: 8px;">${i}</span><span>${c}: ${l}</span>${e.epochNumber>0?`<span style="color: var(--text-secondary); font-size: 11px; margin-left: 1em;">(${d})</span>`:""}</div>`;o.innerHTML+=u}),"live"===t&&o.lastElementChild&&(o.lastElementChild.title="Current epoch"),o.scrollTop=o.scrollHeight}!async function(){await S();let e={currentDocumentKey:null,isDirty:!1};const t=new y;let o=1e5;try{console.log("Starting VDF calibration...");const e=1e4,n=performance.now();await t.compute_proof("calibration",BigInt(e),null);const r=e/((performance.now()-n)/1e3);o=Math.floor(10*r),console.log(`Calibrated to ${o} iterations for 10s`)}catch(e){console.error("VDF calibration failed, using fallback.",e),L("VDF calibration failed, using default timing.","error")}let r,i=[],s=[],a=!1,c=Date.now(),l=0;const d=new Quill("#editor",{theme:"snow",placeholder:"Start writing..."}),u=e=>{s=e},f=()=>s;async function _(){const e={title:document.getElementById("document-title").value||"Untitled Document",version:"2.0",timestamp:(new Date).toISOString(),content:{html:d.root.innerHTML,delta:d.getContents()},proofChain:s,metadata:{epochCount:s.length,genesisHash:s[0]?.hash,latestHash:s[s.length-1]?.hash,totalDuration:s.reduce((e,t)=>e+(t.epochDuration||0),0),documentHash:null}},t={...e,metadata:{...e.metadata,documentHash:null}};return e.metadata.documentHash=await D(JSON.stringify(t)),e}function g(){if(!s||0===s.length)return;a=!0,c=Date.now(),l=0;const e=s[s.length-1];r.postMessage({command:"start",input:e.hash,iterations:o})}function m(){r&&r.terminate(),i=[],r=new Worker(new URL(n.p+n.u(96),n.b)),r.onmessage=async t=>{const{status:n,proof:r,progress:d,error:u}=t.data;if("progress"!==n){if("error"===n)return console.error("VDF Worker Error:",u),void(a=!1);if("complete"===n){const t=(Date.now()-c)/1e3;if(i.length>0){const n=s[s.length-1],a=new $(s.length,n.hash,i,r,o,t);await a.computeHash(),s.push(a),document.getElementById("epoch-number").textContent=a.epochNumber,M(s),i=[],e.isDirty=!0}g()}}else l=d},g()}function p(t,n){d.setContents(t.content.delta),u(t.proofChain),document.getElementById("document-title").value=t.title||"Untitled Document",e.currentDocumentKey=n,e.isDirty=!1;const o=t.proofChain[t.proofChain.length-1];document.getElementById("epoch-number").textContent=o.epochNumber,document.getElementById("last-saved").textContent=`Saved ${new Date(t.timestamp).toLocaleTimeString()}`,M(f()),C(d),m()}function h(){e.isDirty&&!confirm("You have unsaved changes. Are you sure you want to create a new document?")||(d.setContents([{insert:"\n"}]),e.currentDocumentKey=null,e.isDirty=!1,document.getElementById("document-title").value="Untitled Document",document.getElementById("last-saved").textContent="Not saved",u([{epochNumber:0,hash:"0000000000000000000000000000000000000000000000000000000000000000",timestamp:(new Date).toISOString()}]),M(f()),m(),L("New document created.","info"))}d.on("text-change",(t,n,o)=>{"user"===o&&(i.push(t),e.isDirty=!0),C(d)}),document.getElementById("new-doc-btn").onclick=h,document.getElementById("save-btn").onclick=async()=>{let t=e.currentDocumentKey||B+Date.now();e.currentDocumentKey=t,function(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(e){console.error("Error saving to local storage:",e),L("Could not save document. Storage may be full.","error")}}(t,await _()),e.isDirty=!1,document.getElementById("last-saved").textContent=`Saved ${(new Date).toLocaleTimeString()}`,L("Document saved to browser","success")},document.getElementById("import-btn").onclick=()=>document.getElementById("file-input").click(),document.getElementById("verify-live-btn").onclick=async()=>{L("Verifying current document...","info");const e=await _();document.getElementById("modal-backdrop").classList.add("show"),document.getElementById("verification-modal").classList.add("show"),document.querySelector(".verification-progress").style.display="block",document.getElementById("verification-results").style.display="none",O(0,"Starting verification...");const t=await async function(e,t){const n={valid:!0,errors:[],verifiedEpochs:0,totalEpochs:0};try{await S();const o=new y,r=e.proofChain;n.totalEpochs=r.length-1;for(let e=1;e<r.length;e++){const i=r[e];if(t&&t(e/(r.length-1)*100,`Verifying epoch ${e}/${r.length-1}...`),i.previousHash!==r[e-1].hash){n.errors.push(`Epoch ${e}: Broken chain.`),n.valid=!1;continue}try{if(!i.vdfProof||!i.vdfProof.y)throw new Error("Missing VDF proof data.");const e=new E(i.vdfProof.y,i.vdfProof.pi,i.vdfProof.l,i.vdfProof.r,BigInt(i.iterations));if(!await o.verify_proof(i.previousHash,e))throw new Error("Invalid VDF proof.");n.verifiedEpochs++}catch(t){n.errors.push(`Epoch ${e}: VDF verification error: ${t.message}`),n.valid=!1}const s={epochNumber:i.epochNumber,previousHash:i.previousHash,deltas:i.deltas,vdfY:i.vdfProof.y,iterations:i.iterations},a=await D(JSON.stringify(s));i.hash!==a&&(n.errors.push(`Epoch ${e}: Hash mismatch.`),n.valid=!1)}n.valid=0===n.errors.length}catch(e){n.valid=!1,n.errors.push(e.message)}return n}(e,O);(function(e,t){document.querySelector(".verification-progress").style.display="none";const n=document.getElementById("verification-results");n.style.display="block";const o=function(e){const t=function(e){const t=e.slice(1).map(e=>{let t=[];return e.deltas&&e.deltas.forEach(e=>{e&&e.ops&&(t=t.concat(e.ops))}),{deltas:t,duration:e.epochDuration}});if(0===t.length)return{humanScore:0,details:{},metrics:{}};for(const e of t)if(e.deltas){if(e.deltas.length>200)return{humanScore:.05,details:{anomalyReason:"Edit storm detected."},metrics:{}};for(const t of e.deltas)if(t.insert&&t.insert.length>100)return{humanScore:.1,details:{anomalyReason:"Large paste detected."},metrics:{}}}const n=t.map(e=>e.deltas.reduce((e,t)=>e+(t.insert?.length||0),0)),o=n.reduce((e,t)=>e+t,0)/n.length||0,r=n.reduce((e,t)=>e+Math.pow(t-o,2),0)/n.length/(o+1),i=t.filter(e=>0===e.deltas.length).length/t.length,s=t.map(e=>e.deltas.filter(e=>e.insert).length>10?"burst":e.deltas.filter(e=>e.delete).length>e.deltas.filter(e=>e.insert).length?"revision":0===e.deltas.length?"pause":"steady"),a=s.reduce((e,t)=>(e[t]=(e[t]||0)+1,e),{}),c=-Object.values(a).reduce((e,t)=>e-t/s.length*Math.log2(t/s.length),0),l=t.filter(e=>e.deltas.length>0).map(e=>e.deltas.reduce((e,t)=>e+(t.insert?.length||0),0)/10),d=l.reduce((e,t)=>e+t,0)/l.length||0,u=e=>1/(1+Math.exp(-e)),f=(e,t,n)=>Math.exp(-.5*Math.pow((e-t)/n,2)),_={burstScore:u(2*(r-.5)),pauseScore:u(15*(i-.05)),entropyScore:f(c,1,.7),speedScore:f(d,5,3)},g={burstScore:.4,pauseScore:.2,entropyScore:.2,speedScore:.2};return{humanScore:Object.entries(_).reduce((e,[t,n])=>e+n*g[t],0),details:_}}(e);return`\n    <div class="authorship-analysis">\n      <h3>Authorship Analysis</h3>\n      <div class="human-score">${Math.round(100*t.humanScore)}% Human Characteristics</div>\n      <div class="details">\n        <div>Typing Rhythm: ${Math.round(100*(t.details.burstScore||0))}%</div>\n        <div>Pause Patterns: ${Math.round(100*(t.details.pauseScore||0))}%</div>\n        <div>Edit Complexity: ${Math.round(100*(t.details.entropyScore||0))}%</div>\n        <div>Speed Profile: ${Math.round(100*(t.details.speedScore||0))}%</div>\n      </div>\n    </div>\n  `}(t.proofChain);e.valid?n.innerHTML=`\n      <div style="color: var(--primary-color); margin-bottom: 16px; font-size: 18px;">✓ Document verified successfully</div>\n      <div style="margin-bottom: 8px;">Verified Epochs: ${e.verifiedEpochs}/${e.totalEpochs}</div>\n      <div style="margin-bottom: 8px;">Total Duration: ${(t.metadata.totalDuration/60).toFixed(1)} minutes</div>\n      <div style="margin-bottom: 16px;">Final Hash: ${t.metadata.latestHash.substring(0,16)}...</div>\n      ${o}`:n.innerHTML=`\n      <div style="color: #ff4444; margin-bottom: 16px; font-size: 18px;">✗ Verification failed</div>\n      <div style="color: #ff4444; margin-bottom: 16px;">${e.errors.join("<br>")}</div>\n      ${o}`})(t,e),M(f(),"verified",t.errors)};const b=document.getElementById("file-browser-modal"),w=document.getElementById("modal-backdrop"),v=()=>{const e=document.getElementById("file-browser-list");e.innerHTML="";const t=function(){const e=[];for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t);if(n.startsWith(B))try{const t=k(n);t&&t.title&&t.timestamp&&e.push({key:n,title:t.title,timestamp:t.timestamp})}catch(e){console.error(`Could not parse document with key ${n}:`,e)}}return e.sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp))}();0===t.length?e.innerHTML='<p style="color: var(--text-secondary);">No documents saved in this browser.</p>':t.forEach(t=>{const n=document.createElement("div");n.className="file-browser-item",n.innerHTML=`\n          <div class="file-item-info" data-key="${t.key}">\n            <div class="file-browser-title">${t.title}</div>\n            <div class="file-browser-timestamp">Saved: ${new Date(t.timestamp).toLocaleString()}</div>\n          </div>\n          <div class="file-browser-actions">\n            <button class="btn-icon export-btn" title="Export to File" data-key="${t.key}"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg></button>\n            <button class="btn-icon delete-btn" title="Delete" data-key="${t.key}"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg></button>\n          </div>`,e.appendChild(n)}),w.classList.add("show"),b.classList.add("show")},x=()=>{w.classList.remove("show"),b.classList.remove("show")};document.getElementById("browse-local-btn").onclick=v,document.getElementById("file-browser-close").onclick=x,document.getElementById("file-browser-list").addEventListener("click",t=>{const n=t.target.closest("[data-key]");if(!n)return;const o=n.getAttribute("data-key");if(t.target.closest(".delete-btn"))confirm(`Are you sure you want to delete "${k(o).title}"? This cannot be undone.`)&&(function(e){localStorage.removeItem(e)}(o),L("Document deleted","info"),v());else if(t.target.closest(".export-btn")){const e=k(o),t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download=`${e.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.json`,r.click(),URL.revokeObjectURL(n),L("Exporting document...","info")}else if(t.target.closest(".file-item-info")){if(e.isDirty&&!confirm("You have unsaved changes that will be lost. Load document anyway?"))return;const t=k(o);p(t,o),x(),L(`Loaded "${t.title}"`,"success")}}),document.getElementById("file-input").onchange=async t=>{if(t.target.files[0]){L("Importing and verifying...","info");try{const n=await t.target.files[0].text(),o=JSON.parse(n);if(e.isDirty&&!confirm("You have unsaved changes that will be lost. Import anyway?"))return;p(o,null),L("Document imported successfully","success")}catch(e){L(`Error importing file: ${e.message}`,"error")}finally{t.target.value=""}}},document.getElementById("epoch-indicator").onclick=()=>document.getElementById("proof-panel").classList.toggle("show"),document.getElementById("proof-panel-close").onclick=()=>document.getElementById("proof-panel").classList.remove("show"),w.onclick=()=>{H(),x()},document.getElementById("modal-close").onclick=H,h(),L("VDF calibration complete","success"),setInterval(()=>{if(a){const e=(Date.now()-c)/1e3;!function(e,t,n){const o=document.getElementById("timer-countdown");if(o){const t=Math.max(0,10-e);o.textContent=`${t.toFixed(1)}s`}const r=document.getElementById("vdf-progress-bar");r&&(r.style.transform=`scaleX(${n/100})`)}(e,0,l>0?l:Math.min(100,e/10*100))}},50)}()})();